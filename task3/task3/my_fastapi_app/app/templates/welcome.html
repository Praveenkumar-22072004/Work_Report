<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <title>Welcome</title>
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <link rel="stylesheet" href="/static/styles.css">
</head>
<body>
  <div class="welcome-container">

    <!-- Header -->
    <div class="welcome-header">
      <h1>Welcome, {{ username }}</h1>
      <div class="actions">
        <button id="addMemberBtn" class="btn add">+ Add Member</button>
        <a href="/logout"><button class="btn logout">Logout</button></a>
      </div>
    </div>

    <!-- Members Table -->
    {% if members and members|length > 0 %}
      <table>
        <thead>
          <tr>
            <th>Name</th><th>Email</th><th>Phone</th><th>Organization</th><th>Actions</th>
          </tr>
        </thead>
        <tbody>
          {% for m in members %}
          <tr>
            <td>{{ m.name }}</td>
            <td>{{ m.email }}</td>
            <td>{{ m.phone }}</td>
            <td>{{ m.organization }}</td>
            <td>
              <button class="btn edit edit-btn"
                data-id="{{ m.id }}"
                data-name="{{ m.name }}"
                data-email="{{ m.email }}"
                data-phone="{{ m.phone }}"
                data-organization="{{ m.organization }}">
                Edit
              </button>

              <button class="btn delete delete-btn"
                data-id="{{ m.id }}"
                data-name="{{ m.name }}">
                Delete
              </button>
            </td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    {% else %}
      <p style="text-align:center;">No members yet. Add your first one!</p>
    {% endif %}

    <!-- Modal markup (Add/Edit) -->
    <div id="modalOverlay" class="modal-overlay" hidden>
      <div class="modal" role="dialog" aria-modal="true" aria-labelledby="modalTitle">
        <h2 id="modalTitle">Modal</h2>
        <form id="modalForm" method="post" action="/add-member">
          <input type="hidden" name="member_id" id="member_id">

          <div class="form-row">
            <label>Name</label>
            <input id="modal_name" name="name" required>
          </div>

          <div class="form-row">
            <label>Email</label>
            <input id="modal_email" name="email" type="email" required>
          </div>

          <div class="form-row">
            <label>Phone</label>
            <input id="modal_phone" name="phone" required>
          </div>

          <div class="form-row">
            <label>Organization</label>
            <input id="modal_org" name="organization" required>
          </div>

          <div class="actions">
            <button id="modalSave" type="submit" class="btn save">Save</button>
            <button id="modalCancel" type="button" class="btn cancel">Cancel</button>
          </div>
        </form>
      </div>
    </div>

    <!-- Delete confirmation modal -->
    <div id="deleteOverlay" class="modal-overlay" hidden>
      <div class="modal" role="dialog" aria-modal="true" aria-labelledby="deleteTitle">
        <h2 id="deleteTitle">Delete Member</h2>
        <p id="deleteMessage">Are you sure?</p>
        <form id="deleteForm" method="post" action="/delete-member">
          <input type="hidden" name="member_id" id="delete_member_id">
          <div class="actions">
            <button type="submit" class="btn delete">Yes, delete</button>
            <button id="deleteCancel" type="button" class="btn cancel">Cancel</button>
          </div>
        </form>
      </div>
    </div>

  </div>

<script>
const overlay = document.getElementById('modalOverlay');
const deleteOverlay = document.getElementById('deleteOverlay');
const modalForm = document.getElementById('modalForm');
const modalTitle = document.getElementById('modalTitle');
const memberIdInput = document.getElementById('member_id');

// Open Add Modal
function openAddModal() {
  modalTitle.textContent = 'Add Member';
  modalForm.action = '/add-member';
  memberIdInput.value = '';
  document.getElementById('modal_name').value = '';
  document.getElementById('modal_email').value = '';
  document.getElementById('modal_phone').value = '';
  document.getElementById('modal_org').value = '';
  overlay.hidden = false;
  document.getElementById('modal_name').focus();
}

// Open Edit Modal
function openEditModal(e) {
  const btn = e.currentTarget;
  modalTitle.textContent = 'Edit Member';
  modalForm.action = '/edit-member';
  memberIdInput.value = btn.dataset.id;
  document.getElementById('modal_name').value = btn.dataset.name || '';
  document.getElementById('modal_email').value = btn.dataset.email || '';
  document.getElementById('modal_phone').value = btn.dataset.phone || '';
  document.getElementById('modal_org').value = btn.dataset.organization || '';
  overlay.hidden = false;
  document.getElementById('modal_name').focus();
}

// Close Add/Edit Modal
function closeModal() { overlay.hidden = true; }

// Open Delete Modal
function openDeleteModal(e) {
  const btn = e.currentTarget;
  document.getElementById('delete_member_id').value = btn.dataset.id;
  document.getElementById('deleteMessage').textContent = 
    `Delete ${btn.dataset.name}? This action cannot be undone.`;
  deleteOverlay.hidden = false;
}

// Close Delete Modal
function closeDeleteModal() { deleteOverlay.hidden = true; }

document.getElementById('modalCancel').addEventListener('click', closeModal);
document.getElementById('deleteCancel').addEventListener('click', closeDeleteModal);

// After delete form submit, hide modal
document.getElementById('deleteForm').addEventListener('submit', () => {
  deleteOverlay.hidden = true;
});

// Wire up buttons
document.querySelectorAll('.edit-btn').forEach(b => b.addEventListener('click', openEditModal));
document.querySelectorAll('.delete-btn').forEach(b => b.addEventListener('click', openDeleteModal));

// Add Member button
document.getElementById('addMemberBtn').addEventListener('click', openAddModal);

// ESC key closes modals
document.addEventListener('keydown', (e) => {
  if (e.key === 'Escape') {
    if (!overlay.hidden) closeModal();
    if (!deleteOverlay.hidden) closeDeleteModal();
  }
});
</script>
</body>
</html>
